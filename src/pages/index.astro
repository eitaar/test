---
import Layout from '../layouts/Layout.astro';
import bg1 from '../assets/backgrounds/blog-placeholder-1.webp';
import bg2 from '../assets/backgrounds/blog-placeholder-2.webp';
import bg3 from '../assets/backgrounds/blog-placeholder-about.webp';
import bg4 from '../assets/backgrounds/wahoot.webp';

const backgroundImages = [bg1.src, bg2.src, bg3.src, bg4.src];
---

<Layout title="EITAAR - Portfolio" description="EITAAR's creative portfolio and projects">
  <section
    class="relative min-h-screen w-full overflow-hidden"
    id="hero-section"
    data-bg-images={JSON.stringify(backgroundImages)}
  >
    <img
      class="absolute inset-0 h-full w-full object-cover transition-opacity duration-75 ease-out"
      id="parallax-bg"
      alt="Background image"
      loading="eager"
    />
    <!-- Blurred overlay for readability -->
    <div
      class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-colors duration-300 dark:bg-black/60"
    >
    </div>

    <div class="relative z-10 flex min-h-screen flex-col items-center justify-center">
      <div class="mb-8 rounded-xl bg-accent p-6">
        <h1 class="mb-8 text-center font-Bungee text-6xl text-accent-content md:text-8xl">
          EITAAR
        </h1>
        <nav class="flex flex-wrap justify-center gap-8 rounded-xl bg-base-100 p-4">
          <a
            href="/about"
            class="underline-animation group font-Rubik text-xl font-bold text-base-content transition-colors duration-300 hover:text-accent md:text-2xl"
          >
            About
          </a>
          <a
            href="/projects"
            class="underline-animation group font-Rubik text-xl font-bold text-base-content transition-colors duration-300 hover:text-accent md:text-2xl"
          >
            Projects
          </a>
          <a
            href="/blog"
            class="underline-animation group font-Rubik text-xl font-bold text-base-content transition-colors duration-300 hover:text-accent md:text-2xl"
          >
            Blog
          </a>
        </nav>
      </div>
    </div>

    <!-- Theme switching buttons in bottom right corner -->
    <div class="fixed right-6 bottom-6 z-20">
      <div class="flex flex-col items-center gap-2">
        <!-- Hidden labels for accessibility -->
        <span id="light-theme-label" class="sr-only">Light Theme</span>
        <span id="dark-theme-label" class="sr-only">Dark Theme</span>
        <input
          type="radio"
          name="theme-buttons"
          class="theme-controller btn btn-square border-0 outline-0"
          style={'background-color: oklch(58% 0.158 241.966);'}
          value="clean"
          aria-labelledby="light-theme-label"
          onclick="localStorage.setItem('theme', 'clean'); document.documentElement.setAttribute('data-theme', 'clean');"
        />
        <input
          type="radio"
          name="theme-buttons"
          class="theme-controller btn btn-square border-0 outline-0"
          style={'background-color: #474ec0;'}
          value="night"
          aria-labelledby="dark-theme-label"
          onclick="localStorage.setItem('theme', 'cdark'); document.documentElement.setAttribute('data-theme', 'cdark');"
        />
      </div>
    </div>
  </section>
</Layout>

<script>
  // Select a random background image
  function setRandomBackground() {
    const heroSection = document.getElementById('hero-section');
    const bgElement = document.getElementById('parallax-bg') as HTMLImageElement;

    if (!heroSection || !bgElement) {
      console.warn('Hero section or background element not found');
      return;
    }

    try {
      const bgImagesData = heroSection.getAttribute('data-bg-images');
      if (!bgImagesData) {
        console.warn('No background images data found');
        return;
      }

      const backgroundImages = JSON.parse(bgImagesData);

      if (backgroundImages.length === 0) {
        console.warn('No background images found');
        return;
      }

      const randomIndex = Math.floor(Math.random() * backgroundImages.length);
      const selectedImage = backgroundImages[randomIndex];

      bgElement.src = selectedImage;

      // Ensure the image is visible immediately
      bgElement.style.opacity = '1';
    } catch (error) {
      console.error('Error setting background image:', error);
    }
  }

  // Parallax effect based on mouse movement
  function handleMouseMove(e: MouseEvent) {
    const heroSection = document.getElementById('hero-section');
    const bgElement = document.getElementById('parallax-bg') as HTMLImageElement;

    if (!heroSection || !bgElement) return;

    const { clientX, clientY } = e;
    const { innerWidth, innerHeight } = window;

    // Calculate movement based on mouse position (small movement for subtle effect)
    const moveX = (clientX / innerWidth - 0.5) * 20;
    const moveY = (clientY / innerHeight - 0.5) * 20;

    // Apply transform to background image
    bgElement.style.transform = `translate(${moveX}px, ${moveY}px) scale(1.05)`;
  }

  // Cleanup function to remove event listeners
  function cleanup() {
    document.removeEventListener('mousemove', handleMouseMove);
  }

  // Initialize background and parallax
  function initializeBackgroundAndParallax() {
    // Cleanup any existing listeners first
    cleanup();

    // Set background
    setRandomBackground();

    // Add mouse move listener for parallax effect
    document.addEventListener('mousemove', handleMouseMove);
  }

  // Initialize on Astro page load (for view transitions)
  document.addEventListener('astro:page-load', initializeBackgroundAndParallax);

  // Cleanup on page unload (for view transitions)
  document.addEventListener('astro:before-preparation', cleanup);
</script>
